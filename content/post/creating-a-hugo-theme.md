+++
date = "2016-03-28T10:55:08-04:00"
title = "Creating a Hugo Theme"
+++

In my previous post, I explained how to install go and build a basic Hugo site.
In this post, I'll be explaining how to build your own theme, and how to use it
with bootstrap, sass, minified js/css, and gulp.

# Creating a Theme

Creating a theme for Hugo is almost as simple as creating a directory in the
themes directory, and adding a theme.toml file.

## Theme Config

The theme.toml (or theme.yaml / theme.json) file located in the theme root
functions much like a config.toml file in the root of your site. Here is an
example theme config from this site's theme.

<pre><code class="highlight bash">name = "stephenlw.com"
license = "GPLv3"
licenselink = "https://github.com/whobrokethebuild/stephenlw.com/LICENSE"
min_version= 0.13

[author]
name = "Stephen Lane-Walsh"
homepage = "http://stephenlw.com"
</code></pre>

Most parameters are self-explanitory, but the main one to be aware of is the
name field, I don't believe the theme will actually function without that being
set.

# Modifying your theme

The theme really just acts as a set of defaults for the site. All things defined
in the theme can be overridden at the site level. This means that all of the
configuration available at the site level that I outlined in my previous blog
post can be set here.

The most important parts for building a theme are the layouts and the
static/public directories. The layouts directory is where you'll define the HTML
templates that will build your site's content, and the static directory (or
whatever you called it) is where you'll put all of your css/js.

If you're lazy like me and don't feel like finding my previous post (which I do
recommend you read), here are the parts detailing how to use layouts and static
sections.

## Layouts

Layouts are ways of defining the HTML generated by your content. Layouts live
first in your theme, and can be overridden by your top-level layouts/ directory.
Determining the layout to use for a piece of content is done using a hierarchy.

### Single Content

Single content is any piece of content being rendered on its own, be that a page
or a blog post or whatever. The layout file is determined by the following
hierarchy.

 - /layouts/`TYPE`-or-`SECTION`/`LAYOUT`.html
 - /layouts/`TYPE`-or-`SECTION`/single.html
 - /layouts/\_default/single.html
 - /themes/`THEME`/layouts/`TYPE`-or-`SECTION`/`LAYOUT`.html
 - /themes/`THEME`/layouts/`TYPE`-or-`SECTION`/single.html
 - /themes/`THEME`/layouts/\_default/single.html

### List Content

List content is any page that is comprised of multiple pieces of content, such
as a blog page listing all of the recent posts. List layout files are determined
much like the single layout files, but using the following hierarchy.

 - /layouts/section/`SECTION`.html
 - /layouts/\_default/section.html
 - /layouts/\_default/list.html
 - /themes/`THEME`/layouts/section/`SECTION`.html
 - /themes/`THEME`/layouts/\_default/section.html
 - /themes/`THEME`/layouts/\_default/list.html

## Static

The static/ folder is exactly what it sounds like, a place to put static assets.
Both the theme and the site have static/ folders, and when the site is built
Hugo merges them together, with the site taking priority over the theme.

This is where you should put all CSS, JS, and Image files, along with any other
static content or files. Everything in this folder will be copied to the output
directory verbatim, so if you had a folder containing the following.

    └── static/
        ├── css/
        |    └── site.css
        └── js/
             └── site.js

They would end up in the output directory as

    └── output_dir/
        ├── css/
        |    └── site.css
        └── js/
             └── site.js

## Go Template Files

Go uses a Mustache-like templating framework built into the language. With this,
you have access to all of Hugo's data as well as any data you defined in your
config file. The variables you have access to are all accessed using the global
`.` variable.

For more information on variables and what's available, check out here.

https://gohugo.io/templates/variables/

# Using your new theme

To use your new theme, just set it in your site config. If your theme directory
is called `my-cool-theme`, then you would set the following in your config.toml

<pre><code class="highlight bash">theme = "my-cool-theme"</code></pre>

# Using Sass, Minify, Gulp, etc

To configure your project to use any of the cool technologies such as Sass,
Minify, Uglify, etc. we're going to use a tool called Gulp. Gulp and its set
of tools are mostly node packages, so let's install that first.

To use the tools in the way I have, I have laid out my directory structure as
follows:

themes/
    ├── static/
    |   ├── css/
    |   ├── images/
    |   └── fonts/
    └── static_src/
        ├── sass/
        └── js/
            ├── sass/
            └── js/

## Installing the Tools

You can download Node.js from your linux package repository or from
https://nodejs.org/en/

You will also need to download Ruby and Compass, which can be done either from
your linux package repos or https://www.ruby-lang.org/en/downloads/

Once you download Ruby, you can install compass with the following command,
which may have some other build requirements based on your system.

    gem install compass

## Configuring NPM

Once installed, you should be able to run npm from your command line. NPM is the
Node Package Manager, which we'll be using to install gulp and the packages it
needs. To install gulp and the packages we need, go to your theme's directory
in a command line, and run the following commands.

    npm install -g gulp-cli
    npm install --save-dev gulp gulp-compass gulp-concat gulp-cssnano \
        gulp-rename gulp-sourcemaps gulp-uglify

The first command installs the `gulp` command globally on your system. The
second installs the dependencies we'll need for this project specifically and
adds them to a file named `package.json`

Once you do this, all of the packages will be listed in the `package.json` file,
so when you want to set up the project on a different computer or reinstall the
node packages, you only need to run the following from your theme directory.

    npm install

## Configuring Gulp

Gulp uses a file named `gulpfile.js` to execute it's commands. Every gulpfile
generally starts by requiring all of the packages we need and assigning them to
variables within the script. This can be done like so:

<pre><code class="highlight js">var gulp             = require('gulp'),
    compass          = require('gulp-compass'),
    sourcemaps 		 = require('gulp-sourcemaps'),
    cssnano          = require('gulp-cssnano'),
    uglify           = require('gulp-uglify'),
    rename           = require('gulp-rename'),
    concat           = require('gulp-concat'),
    path             = require('path');
</code></pre>

Once that's done, you go about setting up your tasks. Each task can be run from
the command line in the format of:

    gulp [taskname]

Where [taskname] is replaced with the name of the task you're trying to run.
Gulp also has a special task named 'default' that runs when you simply run
`gulp` with no task specified.

Let's define our first task then, and have it compile the styles.

<pre><code class="highlight js">gulp.task('styles', function(){
    return gulp.src(['static_src/scss/**/*.scss'])
        .pipe(compass({
            project: path.join(__dirname, './'),
            css: 'static/css',
            image: 'static/images',
            sass: 'static_src/scss',
            style: 'compressed',
            sourcemap: true
        }))
        .pipe(cssnano())
        .pipe(gulp.dest('static/css'));
});
</code></pre>

To walk you through each step, this creates a task named 'styles' and assigns it
to a function. That function then reads all of the files from static_src/*.scss
and runs them through compass, a tool that compiles sass into css. Compass takes
a few parameters itself which you should make sure match your setup, but
otherwise it'll work fine. Then gulp sends the files through cssnano which
minifies them, and finally outputs the files as .css files in the static/
directory.

Now, let's do the javascript.

<pre><code class="highlight js">gulp.task('scripts', function(){
	gulp.src(['static_src/js/lib/**/*.js'])
		.pipe(uglify())
		.pipe(gulp.dest('static/js'));
	return gulp.src('static_src/js/site/**/*.js')
		.pipe(concat('site.js'))
    	.pipe(sourcemaps.init())
		.pipe(gulp.dest('static/js'))
		.pipe(rename({ suffix: '.min' }))
		.pipe(uglify())
    	.pipe(sourcemaps.write())
		.pipe(gulp.dest('static/js'));
});
</code></pre>

This first takes all of the .js files from `static_src/js/lib/` and uglifies
them. Then it puts them into the `static/js/` directory under their original
names. This should be used for library files such as jquery.js.

The next section takes all of our javascript files, located in
`static_src/js/site/`. The sourcemaps.init() line saves off the original
versions of the files so it can generate sourcemaps at the end. Then it puts all
of them in a single file named `site.js` and writes it to the `static/js/`
directory. This version of your code is unminified and should only be used if
you're debugging. The next step is to change the filename to `site.min.js` and
run it through uglify(), which will minify and optimize the javascript. At this
point we write our sourcemaps so the browser knows what to do with the minified
file, and we write it to the `static/js/` directory.

We then are going to create two more tasks, one to run both scripts and styles
once and then exit, and one to watch for changes in files and re-run the tasks
if needed.

<pre><code class="highlight js">gulp.task('build', ['styles', 'scripts']);

gulp.task('default', ['styles', 'scripts'], function(){
	gulp.watch('static_src/scss/**/*.scss', ['styles']);
	gulp.watch('static_src/js/**/*.js', ['scripts']);
});
</code></pre>

## Running Gulp

Now all that's left is to run our script, and then reference the compiled files
in our HTML. To run the gulp task that watches files and updates when changes
are made, run the following:

    gulp

This also goes very well with `hugo server` as it will refresh the page even
when gulp changes files. 
